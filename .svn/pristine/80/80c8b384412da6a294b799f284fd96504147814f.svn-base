const path = require('path');

const resolve = dir => {
    return path.join(__dirname, dir);
}
const addStyleResource = (rule) => {
    rule.use('style-resource')
        .loader('style-resources-loader')
        .options({
            patterns: [
                resolve('src/assets/less/global.less'),
            ],
        })
}

module.exports = {
    publicPath: '/',

    chainWebpack: config => {
        config.resolve.alias
            .set('vue$', 'vue/dist/vue.esm.js')
            .set('@', resolve('src'))
        const types = ['vue-modules', 'vue', 'normal-modules', 'normal'];
        //全局less
        types.forEach(type => addStyleResource(config.module.rule('less').oneOf(type)));
    },

    productionSourceMap: false,

    devServer: {
        disableHostCheck: true,
        before(app) {
            app.all("/*", (req, res, next) => {
                //res？带点什么给后端？
                const path = req.path;
                const staticeResouceReg = /(.+\..+$)/;
                if (!staticeResouceReg.test(path)) {
                    console.log(`${req.method}：${req.path}`);
                }

                next();
            })
        },
        proxy: {
            '/api': {
                target: 'http://192.168.2.206:8088/',
                secure: false,
                changeOrigin: true
            },
            '/wx': {
                target: 'http://192.168.2.206:8088/',
                secure: false,
                changeOrigin: true
            }

        },
        port: 4000
    },

    pluginOptions: {
        'style-resources-loader': {
            preProcessor: 'less',
            patterns: []
        }
    }
}

